#!/bin/bash
#
#SBATCH -J permediatr
#SBATCH --time=2-00:00:00
#SBATCH -n 1
#SBATCH --cpus-per-task=7
#SBATCH --mem=5G
#SBATCH --partition=ncf_holy
# Outputs ----------------------------------
#SBATCH -o %x-%A-%a.out
#SBATCH -e %x-%A-%a.err
#SBATCH --mail-user=john_flournoy@fas.harvard.edu
#SBATCH --mail-type=ALL
# ------------------------------------------
#
#usage: sbatch --array=0-63 /home/jflournoy/Rlibs/permediatr/bin/permediatr_simulation.R

nreps=100
nperms=100
mccores=7
J=100
nj=4
a=(0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9 0 0.3 0.6 0.9)
b=(0 0 0 0 0.3 0.3 0.3 0.3 0.6 0.6 0.6 0.6 0.9 0.9 0.9 0.9 0 0 0 0 0.3 0.3 0.3 0.3 0.6 0.6 0.6 0.6 0.9 0.9 0.9 0.9 0 0 0 0 0.3 0.3 0.3 0.3 0.6 0.6 0.6 0.6 0.9 0.9 0.9 0.9 0 0 0 0 0.3 0.3 0.3 0.3 0.6 0.6 0.6 0.6 0.9 0.9 0.9 0.9)
cp=(0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9)
thetaab=0.2
optimizer="bobyqa"
dataout="./"
name=(pmjob_00 pmjob_01 pmjob_02 pmjob_03 pmjob_04 pmjob_05 pmjob_06 pmjob_07 pmjob_08 pmjob_09 pmjob_10 pmjob_11 pmjob_12 pmjob_13 pmjob_14 pmjob_15 pmjob_16 pmjob_17 pmjob_18 pmjob_19 pmjob_20 pmjob_21 pmjob_22 pmjob_23 pmjob_24 pmjob_25 pmjob_26 pmjob_27 pmjob_28 pmjob_29 pmjob_30 pmjob_31 pmjob_32 pmjob_33 pmjob_34 pmjob_35 pmjob_36 pmjob_37 pmjob_38 pmjob_39 pmjob_40 pmjob_41 pmjob_42 pmjob_43 pmjob_44 pmjob_45 pmjob_46 pmjob_47 pmjob_48 pmjob_49 pmjob_50 pmjob_51 pmjob_52 pmjob_53 pmjob_54 pmjob_55 pmjob_56 pmjob_57 pmjob_58 pmjob_59 pmjob_60 pmjob_61 pmjob_62 pmjob_63)
index=${SLURM_ARRAY_TASK_ID}
permediatrpath=/home/jflournoy/Rlibs/permediatr/bin/permediatr_simulation.R

Rscript "${permediatrpath}" --nreps "${nreps}" --nperms "${nperms}" --mc.cores "${mccores}" --J "${J}" --n_j "${nj}" --a "${a${index}}" --b "${b${index}}" --c_p "${cp${index}}" --theta_ab "${thetaab${index}}" --optimizer "${optimizer}" "${dataout}" "${name${index}}"
